<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>后山论坛</title>
    <link rel="stylesheet" href="./css/bootstrap.min.css">
    <link rel="stylesheet" href="./css/bootstrap-theme.min.css">
    <link rel="stylesheet" href="./css/community.css">
    <link rel="stylesheet" href="./css/config.css">

    <script src="./js/jquery-3.4.1.min.js"></script>
    <script src="./js/bootstrap.min.js" type="application/javascript"></script>
    <script src="./js/community.js" type="application/javascript"></script>
    <style>
        hr {
            margin-top: 20px;
            margin-bottom: 20px;
            border: 0;
            border-top: 1px solid #eee;
        }
    </style>
</head>
<body>
<script src="./js/navbar.js" type="text/javascript"></script>
<div class="container-fluid main profile">
    <div class="row">
        <!--左边主要内容-->
        <div class="col-lg-9 col-md-12 col-sm-12 col-xs-12">
            <!--正文-->
            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                <h4 class="question-title"><span id="title">登录时获取不了token，有大佬有时间可以给看下代码问题吗微信15000823209 谢谢</span></h4>
                <span class="text-desc">
                        作者：<span class="author">wanglei</span> |
                        发布时间：<span id="createDate">2020-08-13 09:15</span> |
                        阅读数： <span id="view_count">50</span>
                                <input id="author_id" type="hidden" value=""/>
                    </span>
                <hr class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                <!--内容-->
                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12" id="question-view">
                    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 top-header">
                        <a href="#   " target="_blank" style="color: #A00;font-weight: bold;">星光培训你值得拥有</a>
                        <img src="./img/hot.png">
                    </div>
                    <div id="description"></div>
                </div>
                <!--标签-->
                <hr class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                        <span class="question-tag">
                            <a href="#" class="community-tag" id="tag">test</a>
                        </span>
                </div>
                <!--编辑-->
                <hr class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">

                </div>
                <hr class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
            </div>

            <!--回复-->
            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                <h4>
                    <span>2</span> 个回复
                </h4>
                <hr class="col-lg-12 col-md-12 col-sm-12 col-xs-12 comment-sp">
                <div id="commentDescription">
                    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 comments">
                        <div class="media">
                            <div class="media-left">
                                <a href="#">
                                    <img class="media-object img-rounded"
                                         src="">
                                </a>
                            </div>
                            <div class="media-body" id="comment-body-3315">
                                <h5 class="media-heading">
                                    <span>瓦刀</span>
                                </h5>
                                <div>①通过请求参数访问Github API的方式已经被废弃，可以按照此教程修改一小段代码：https://niter.cn/p/115。
                                    ②也有可能是连接不稳定，参考这个帖子配置host ：https://niter.cn/p/125
                                    ③github服务器在国外，极其不稳定，建议多尝试几次试试，实在不行，建议放弃，使用百度等第三方登录方式。
                                </div>
                                <div class="menu">
                                    <span class="glyphicon glyphicon-thumbs-up icon"></span>
                                    <span data-id="3315" class="comment-icon">
                                        <span class="glyphicon glyphicon-comment"></span>
                                        <span>0</span>
                                    </span>
                                    <span class="pull-right">2020-08-13</span>
                                </div>
                                <!--二级评论-->
                                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 collapse sub-comments"
                                     id="comment-3315">
                                    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                                        <input type="text" class="form-control" placeholder="评论一下……" id="input-3315">
                                        <button type="button" class="btn btn-success pull-right"
                                                data-id="3315">评论
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 comments">
                        <div class="media">
                            <div class="media-left">
                                <a href="#">
                                    <img class="media-object img-rounded"
                                         src="#">
                                </a>
                            </div>
                            <div class="media-body" id="comment-body-3314">
                                <h5 class="media-heading">
                                    <span>skyline</span>
                                </h5>
                                <div>不明所以</div>
                                <div class="menu">
                                    <span class="glyphicon glyphicon-thumbs-up icon"></span>
                                    <span data-id="3314" class="comment-icon">
                                        <span class="glyphicon glyphicon-comment"></span>
                                        <span>0</span>
                                    </span>
                                    <span class="pull-right">2020-08-13</span>
                                </div>
                                <!--二级评论-->
                                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 collapse sub-comments"
                                     id="comment-3314">
                                    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                                        <input type="text" class="form-control" placeholder="评论一下……" id="input-3314">
                                        <button type="button" class="btn btn-success pull-right" onclick="comment(this)"
                                                data-id="3314">评论
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!--回复输入框-->
            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                <h4>
                    提交回复
                </h4>
                <hr class="col-lg-12 col-md-12 col-sm-12 col-xs-12 comment-sp">
                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12" id="comment_section">
                    <div class="media">
                        <div class="media-left">
                            <a href="#">
                                <img class="media-object img-rounded" src="#" id="UserInfo_Icon">
                            </a>
                        </div>
                        <div class="media-body">
                            <h5 class="media-heading">
                                <span id="UserInfo_accountName"></span>
                            </h5>
                        </div>
                    </div>
                    <input type="hidden" id="question_id" value="">
                    <textarea class="form-control comment" rows="6" id="comment_content" value=""></textarea>
                    <button type="button" class="btn btn-success btn-comment" id="publishComment">回复</button>
                </div>
            </div>
        </div>

        <!--右边信息块-->
        <div class="col-lg-3 col-md-12 col-sm-12 col-xs-12">
            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                <h4>发起人</h4>
                <div class="media">
                    <div class="media-left">
                        <a href="#">
                            <img class="media-object img-rounded" id="author_icon"
                                 src="">
                        </a>
                    </div>
                    <div class="media-body">
                        <h5 class="media-heading">
                            <span class="author">wanglei</span>
                        </h5>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-3 col-md-12 col-sm-12 col-xs-12">
            <div>
                <div>
                    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 side">
                        <h4>广告</h4>
                        <img class="img-thumbnail question-wechat" src="./picture/official-account.png">
                    </div>
                </div>
            </div>
            <hr class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                <h4>赞助商家</h4>
                <a href="#" class="community-tag">阿里巴巴</a>
                <a href="#" class="community-tag">javascript</a>
                <a href="#" class="community-tag">爱美食</a>
                <a href="#" class="community-tag">好丽友</a>
                <a href="#" class="community-tag">css</a>
                <a href="#" class="community-tag">XXX</a>
                <a href="#" class="community-tag">XXX</a>
                <a href="#" class="community-tag">html5</a>
                <a href="#" class="community-tag">XXX</a>
                <a href="#" class="community-tag">XXX</a>
            </div>
            <div>
                <div>
                    <hr class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 side">
                        <a href="#" onclick="" target="_blank">
                            <img class="img-thumbnail question-wechat" src="./picture/uhost.png">
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="./js/footer.js"></script>
<script>
    var email;
    $(function () {
        $.ajax({
            url: "user/getSession",
            type: "GET",
            contentType: "application/json;charset=utf-8",
            success: function (response) {
                email = response;
                refresh();
                uploadUserInfo();
            }
        })
    });

    function refresh() {
        var params = window.location.search;
        var id = params.substring(params.indexOf("=") + 1)
        $.ajax({
            url: "comment/getAllComment?id=" + id,
            type: "GET",
            contentType: "application/json;charset=utf-8",
            dataType: "json",
            success: function (response) {
                $("#author_id").empty().val(response[0].question.creatorid);
                $("#title").empty().text(response[0].question.title);
                $(".author").empty().text(response[0].accountName);
                $("#question_id").empty().val(response[0].question.id);
                $("#author_icon").attr("src", "static/upload/" + response[0].icon);
                $("#description").empty().html(response[0].question.description);
                $("#createDate").empty().text(response[0].question.createDate);
                $("#view_count").empty().text(response[0].question.viewCount);
                $("#tag").empty().text(response[0].question.tag);
            },
            error: function (response) {
                console.error(response)
            }
        })
    }

    function uploadUserInfo() {
        $.ajax({
            url: "user/getUserConfig?email=" + email,
            type: "GET",
            contentType: "application/json;charset=utf-8",
            dataType: "json",
            success: function (response) {
                $("#UserInfo_Icon").attr("src", "static/upload/" + response.icon);
                $("#UserInfo_accountName").text(response['accountName']);
            },
            error: function (response) {
            }
        })
    }

    $("#publishComment").click(function () {
        var creatorId = $("#author_id").val();
        var questionId = $("#question_id").val();
        var commentDescription = $("#comment_content").val();
        var date = new Date();
        var Month = date.getMonth() + 1;
        var commentDate = date.getFullYear() + "-" + Month + "-" + date.getDate();

        var json = {
            creatorId: creatorId,
            questionId: questionId,
            commentDescription: commentDescription,
            commentDate: commentDate
        }
        var jsonStr = JSON.stringify(json)
        console.log(jsonStr)
        $.ajax({
            url: "comment/publishComment",
            type: "POST",
            data: jsonStr,
            contentType: "application/json;charset=utf-8",
            dataType: "json",
            success:function (response) {
                alert("回复成功！")
            },
            error:function (response) {
                console.log(response)
            }
        })
    })


</script>
</body>
</html>